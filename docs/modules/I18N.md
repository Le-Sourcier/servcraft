# I18n Module

Internationalization and localization support for multi-language applications.

## Features

- **Translation Management** - Load and manage translations from files or programmatically
- **Variable Interpolation** - Dynamic values in translations
- **Pluralization** - Proper plural forms using Intl.PluralRules
- **Date/Number/Currency Formatting** - Locale-aware formatting
- **Relative Time** - Human-readable relative time (e.g., "2 hours ago")
- **RTL Support** - Right-to-left language support

## Supported Locales (Built-in)

| Code | Language | Direction | Currency |
|------|----------|-----------|----------|
| `en` | English | LTR | USD |
| `fr` | Français | LTR | EUR |
| `es` | Español | LTR | EUR |
| `de` | Deutsch | LTR | EUR |
| `ar` | العربية | RTL | SAR |
| `zh` | 中文 | LTR | CNY |
| `ja` | 日本語 | LTR | JPY |

## Usage

### Configuration

```typescript
import { I18nService } from 'servcraft/modules/i18n';

const i18n = new I18nService({
  defaultLocale: 'en',
  supportedLocales: ['en', 'fr', 'es', 'de'],
  fallbackLocale: 'en',
  translationsDir: './locales',
  cache: true,
  debug: false,
});

// Load translations from files
await i18n.loadTranslations('en', 'common');
await i18n.loadTranslations('fr', 'common');
```

### File Structure

```
locales/
├── en/
│   ├── common.json
│   └── errors.json
├── fr/
│   ├── common.json
│   └── errors.json
└── es/
    ├── common.json
    └── errors.json
```

### Translation File Format

```json
// locales/en/common.json
{
  "welcome": "Welcome, {{name}}!",
  "items": "You have {{count}} item{s}",
  "user": {
    "profile": {
      "title": "User Profile",
      "settings": "Settings"
    }
  }
}
```

### Basic Translation

```typescript
// Simple translation
const text = i18n.t('welcome');
// "Welcome, {{name}}!"

// With locale
const frText = i18n.t('welcome', { locale: 'fr' });

// With namespace
const errorText = i18n.t('notFound', { namespace: 'errors' });

// Nested keys
const title = i18n.t('user.profile.title');
// "User Profile"
```

### Variable Interpolation

```typescript
const welcome = i18n.t('welcome', {
  variables: { name: 'John' }
});
// "Welcome, John!"
```

### Pluralization

```typescript
// Translation: "You have {{count}} item{s}"
const items1 = i18n.t('items', { count: 1 });
// "You have 1 item"

const items5 = i18n.t('items', { count: 5 });
// "You have 5 items"
```

### Formatting

```typescript
// Date formatting
const date = i18n.formatDate(new Date(), 'en', {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});
// "December 20, 2024"

// Number formatting
const number = i18n.formatNumber(1234567.89, 'de');
// "1.234.567,89"

// Currency formatting
const price = i18n.formatCurrency(99.99, 'en', 'USD');
// "$99.99"

const euroPrice = i18n.formatCurrency(99.99, 'fr', 'EUR');
// "99,99 €"

// Relative time
const relative = i18n.formatRelativeTime(new Date(Date.now() - 3600000), 'en');
// "1 hour ago"
```

### Programmatic Translations

```typescript
// Add translations at runtime
i18n.addTranslations({
  locale: 'en',
  namespace: 'common',
  data: {
    newFeature: 'Check out our new feature!',
    button: {
      save: 'Save',
      cancel: 'Cancel',
    },
  },
});
```

### Locale Information

```typescript
// Get locale info
const info = i18n.getLocaleInfo('ar');
// {
//   code: 'ar',
//   name: 'العربية',
//   englishName: 'Arabic',
//   direction: 'rtl',
//   dateFormat: 'DD/MM/YYYY',
//   currency: 'SAR'
// }

// Check if locale is supported
if (i18n.isLocaleSupported('fr')) {
  // Use French
}

// Get supported locales
const locales = i18n.getSupportedLocales();
// ['en', 'fr', 'es', 'de']
```

### Translation Metadata

```typescript
// Get translation statistics
const metadata = await i18n.getTranslationMetadata('fr', 'common');
// {
//   totalKeys: 50,
//   translatedKeys: 45,
//   completionPercentage: 90
// }

// Find missing translations
const missing = i18n.getMissingTranslations('en', 'fr', 'common');
// ['newFeature', 'button.help']
```

### Cache Management

```typescript
// Clear translation cache
i18n.clearCache();

// Export translations for backup/editing
const translations = i18n.exportTranslations('en', 'common');
```

## Configuration Types

```typescript
interface I18nConfig {
  defaultLocale: string;
  supportedLocales: string[];
  fallbackLocale?: string;
  translationsDir?: string;
  cache?: boolean;
  debug?: boolean;
}

interface TranslationOptions {
  locale?: string;
  namespace?: string;
  variables?: Record<string, string | number>;
  count?: number;
  defaultValue?: string;
}
```

## Fastify Integration

```typescript
// Detect locale from request
fastify.addHook('preHandler', async (request) => {
  const acceptLanguage = request.headers['accept-language'];
  const locale = parseAcceptLanguage(acceptLanguage) || 'en';

  if (i18n.isLocaleSupported(locale)) {
    request.locale = locale;
  } else {
    request.locale = 'en';
  }
});

// Use in routes
fastify.get('/api/welcome', async (request, reply) => {
  const message = i18n.t('welcome', {
    locale: request.locale,
    variables: { name: request.user?.name },
  });

  return { message };
});
```

## React Integration Example

```typescript
// Create hook
function useTranslation(namespace = 'common') {
  const locale = useLocale();

  return {
    t: (key: string, options?: TranslationOptions) =>
      i18n.t(key, { locale, namespace, ...options }),
    formatDate: (date: Date, options?: DateFormatOptions) =>
      i18n.formatDate(date, locale, options),
    formatCurrency: (value: number, currency?: string) =>
      i18n.formatCurrency(value, locale, currency),
  };
}

// Usage
function Welcome({ user }) {
  const { t, formatCurrency } = useTranslation();

  return (
    <div>
      <h1>{t('welcome', { variables: { name: user.name } })}</h1>
      <p>{t('balance')}: {formatCurrency(user.balance)}</p>
    </div>
  );
}
```

## Best Practices

1. **Key Naming** - Use dot notation for namespacing: `user.profile.title`
2. **Variables** - Use meaningful variable names: `{{userName}}` not `{{n}}`
3. **Fallback** - Always configure a fallback locale
4. **Lazy Loading** - Load translations on demand for large apps
5. **Missing Keys** - Log missing translations in development
6. **RTL** - Test with RTL languages early in development
